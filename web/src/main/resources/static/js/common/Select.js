!function(e,t){"function"==typeof define&&(define.amd||define.cmd)?define(t):e.Select=t()}(this,function(require){"function"==typeof require&&require("common/ui/Enhance");var e="ui-select",t="ui-".replace(/[a-z]/gi,"");$.fn.selectMatch=function(){return $(this).each(function(){var e=$(this);e.data("select")?e.data("select").refresh():new a(e)})};var a=function(a){if(a){a.length||(a=$(a));var i=a[0].id;i||(i=("id_"+Math.random()).replace("0.","")),this.id=i;var s=a.prop("multiple");this.multiple=s;var n=$("<div></div>").attr({role:"combobox"}),o=$("<a></a>").attr({href:"javascript:","data-target":i,role:"button","aria-expanded":"false","aria-owns":i}).addClass(e+t+"button"),r=$("<div></div>").attr({id:i,role:"listbox","aria-expanded":"true"}).addClass(e+t+"datalist");s?(n.append(r),a.css({position:"absolute",zIndex:1}).after(n),r.attr("aria-hidden","true")):(n.append(o).append(r),a.hide().after(n)),this.el={sel:a,combobox:n,button:o,datalist:r},this.refresh(),this.events(),a.data("select",this)}else window.console&&window.console.error("Select实例方法参数缺失")};return a.prototype.events=function(){var e=this,t=e.el,a=t.sel,i=t.combobox,s=t.button,n=t.datalist;this.multiple?(a.on("change",function(){e.refresh()}),a.on("scroll",function(){n.scrollTop(a.scrollTop())}),a.on("mousedown",function(){a.data("active","true")}).on("mousemove",function(t){if(a.data("active"))e.refresh();else{var i=t.clientY,s=n.find("a");s.removeAttr("href"),s.each(function(){var e=this.getBoundingClientRect().top,t=e+this.clientHeight;if(i>=e&&i<=t)return 0==$(this).hasClass("selected")&&(this.href="javascript:"),!1})}}).on("mouseout",function(){n.find("a").removeAttr("href")}),$(document).on("mouseup",function(){a.removeData("active")})):(s.on("click",function(){if(a.prop("disabled"))return!1;if(i.toggleClass("active"),i.hasClass("active")){var e=n.offset().top+n.outerHeight()>Math.max($(document.body).height(),$(window).height());i[e?"addClass":"removeClass"]("reverse"),s.attr("aria-expanded","true");var t=i.data("scrollTop"),o=n.find(".selected");t&&t[1]==o.attr("data-index")&&t[2]==o.text()&&(n.scrollTop(t[0]),i.removeData("scrollTop"))}else i.removeClass("reverse"),s.attr("aria-expanded","false")}),n.on("click","a[data-index]",function(){var t=$(this).hasClass("disabled"),o=$(this).data("index"),r=n.scrollTop();i.data("scrollTop",[r,o,$(this).text()]),0==t&&(a.find("option")[o].selected=!0),i.removeClass("active"),s.attr("aria-expanded","false"),s.focus().blur(),0==t&&(e.refresh(),a.trigger("change"))}),$(document).on("mouseup",function(e){var t=e.target;t&&i.hasClass("active")&&i[0]!==t&&0==i[0].contains(t)&&i.removeClass("active").removeClass("reverse")}))},a.prototype.getData=function(){var e=this.el.sel.find("option");return 0==e.length?[{html:""}]:e.map(function(){var e=this;return{html:e.innerHTML,value:e.value,selected:e.selected,disabled:e.disabled,className:e.className}})},a.prototype.refresh=function(a){var i=this,s=i.id,n=i.multiple,o=i.el,r=o.sel,l=o.combobox,d=o.button,c=o.datalist;return a=a||i.getData(),l.attr("class",$.trim(r[0].className+" "+e)).width(r.outerWidth()),n?l.height(r.outerHeight()):d.html('<span class="'+e+t+'text">'+function(){var e="";return $.each(a,function(t,a){a.selected&&(e=a.html)}),e||a[0].html}()+'</span><i class="'+e+t+'icon" aria-hidden="true"></i>'),c.html($.map(a,function(a,i){var o=[e+t+"datalist"+t+"li",a.className];return a.selected&&o.push("selected"),a.disabled&&o.push("disabled"),n?'<a class="'+o.join(" ")+'" data-index='+i+">"+a.html+"</a>":"<a "+(a.disabled?"":'href="javascript:" ')+'class="'+o.join(" ")+'" data-index='+i+' data-target="'+s+'" role="option" aria-selected="'+a.selected+'">'+a.html+"</a>"}).join("")),this},a});